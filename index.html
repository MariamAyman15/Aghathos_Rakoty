<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø£ÙŠØ§Ù… ÙˆØ£ÙŠØ§Ù…</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2e; --muted:#9fb0d0; --text:#eef3ff;
      --accent:#7dd3fc; --good:#34d399; --warn:#fbbf24; --bad:#fb7185; --blue:#60a5fa;
      --border:rgba(255,255,255,.10);
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;
    }
    @media (prefers-color-scheme: light) {
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:rgba(0,0,0,.08);
    }
  
    body{
      background:linear-gradient(180deg,#eef2f7,#f7f9fc);
    }
  
    .card{
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
  
    .bar{
      background:rgba(0,0,0,.08);
    }
  }
    body{margin:0;background:linear-gradient(180deg,#070b14, #0b1220);color:var(--text);}
    .wrap{max-width:1120px;margin:0 auto;padding:18px;}
    .hero{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;}
    .title{font-size:28px;font-weight:950;letter-spacing:.2px}
    .sub{color:#dbe7ff;font-size:14px;margin-top:8px;line-height:1.95;max-width:820px}
    .pill{border:1px solid var(--border);padding:8px 12px;border-radius:999px;color:var(--muted);font-size:13px;white-space:nowrap}
    .grid{display:grid;grid-template-columns:1.35fr .65fr;gap:14px;margin-top:14px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
    .card{background:rgba(17,26,46,.86);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 10px 25px rgba(0,0,0,.25)}
    h3{margin:0 0 10px;font-size:16px}
    label{display:block;font-size:14px;margin:10px 0 6px;color:#dbe7ff}
    input[type="text"]{width:100%;background:#0a1020;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px;outline:none}
    .section{border:1px solid var(--border);border-radius:16px;padding:12px;margin:10px 0;background:rgba(10,16,32,.55)}
    .secTitle{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:6px}
    .secTitle b{font-size:14px}
    .secHint{color:var(--muted);font-size:12px}
    .q{border-top:1px dashed rgba(255,255,255,.12);padding-top:10px;margin-top:10px}
    .q:first-child{border-top:none;padding-top:0;margin-top:0}
    .qText{font-size:13.5px;line-height:1.65;color:#eef3ff}
    .qRow{display:flex;gap:10px;align-items:center;margin-top:6px}
    .qRow input[type="range"]{width:100%}
    .val{min-width:56px;text-align:left;font-weight:950;font-variant-numeric: tabular-nums}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      border:1px solid var(--border);
      background:#0a1020;color:var(--text);
      padding:10px 12px;border-radius:12px;font-weight:950;cursor:pointer
    }
    button.primary{background:linear-gradient(90deg,#38bdf8,#22c55e);border:none;color:#041019}
    button.secondary{background:rgba(125,211,252,.12)}
    button.danger{background:rgba(251,113,133,.12);border:1px solid rgba(251,113,133,.35)}
    .tiny{font-size:12px;color:var(--muted);line-height:1.7}
    .resultBox{border-radius:16px;padding:12px;border:1px solid var(--border);background:rgba(10,16,32,.65)}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
    .season{display:inline-flex;align-items:center;gap:8px;font-weight:950}
    .dot{width:10px;height:10px;border-radius:50%}
    .bar{height:8px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden}
    .bar > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#fb7185,#fbbf24,#34d399,#60a5fa)}
    .verse{margin-top:10px;line-height:1.9;color:#eef3ff}
    .verseRef{color:var(--muted);font-size:13px;margin-top:4px}
    .step{margin-top:10px;color:#dbe7ff;line-height:1.85}
    .mini{margin-top:10px;border-top:1px solid rgba(255,255,255,.12);padding-top:10px}
    .kpi{display:flex;justify-content:space-between;gap:10px;align-items:center;margin:10px 0}
    .kpi b{font-size:13px}
    .badge{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:#dbe7ff;background:rgba(255,255,255,.04)}
    .modalOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.65);
      display:flex; align-items:center; justify-content:center;
      padding:18px; z-index:50;
    }
    .modal{
      width:min(860px, 100%);
      border:1px solid var(--border);
      background:rgba(17,26,46,.96);
      border-radius:20px;
      padding:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.5);
    }
    .modal h2{margin:0 0 8px;font-size:18px}
    .modal p{margin:0;color:#dbe7ff;line-height:1.85}
    .opts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    @media (max-width:720px){ .opts{grid-template-columns:1fr} }
    .optBtn{
      text-align:right; padding:12px; border-radius:16px;
      border:1px solid var(--border); background:rgba(10,16,32,.55);
      color:var(--text); cursor:pointer; font-weight:950;
    }
    .optBtn small{display:block;margin-top:6px;color:var(--muted);font-weight:650;line-height:1.6}
    .modalFooter{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <div class="title">Ø£ÙŠØ§Ù… ÙˆØ£ÙŠØ§Ù…</div>
        <div class="sub">
          Â«Ù„Ø£ÙÙ†Ù‘ÙÙŠ Ø¹ÙØ±ÙÙÙ’ØªÙ Ø§Ù„Ø£ÙÙÙ’ÙƒÙØ§Ø±Ù Ø§Ù„Ù‘ÙØªÙÙŠ Ø£ÙÙ†ÙØ§ Ù…ÙÙÙ’ØªÙÙƒÙØ±ÙŒ Ø¨ÙÙ‡ÙØ§ Ø¹ÙÙ†Ù’ÙƒÙÙ…Ù’ØŒ ÙŠÙÙ‚ÙÙˆÙ„Ù Ø§Ù„Ø±Ù‘ÙØ¨Ù‘ÙØŒ Ø£ÙÙÙ’ÙƒÙØ§Ø±Ù Ø³ÙÙ„Ø§ÙÙ…Ù Ù„Ø§Ù Ø´ÙØ±Ù‘ÙØŒ Ù„ÙØ£ÙØ¹Ù’Ø·ÙÙŠÙÙƒÙÙ…Ù’ Ø¢Ø®ÙØ±ÙØ©Ù‹ ÙˆÙØ±ÙØ¬ÙØ§Ø¡Ù‹.Â»
          <br><span class="tiny">(Ø¥Ø±Ù…ÙŠØ§ØŒ 29ØŒ 11)</span>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <span class="badge">0 = Ù„Ø§ ÙŠØ­Ø¯Ø«</span>
          <span class="badge">5 = ÙŠØ­Ø¯Ø« Ø¯Ø§Ø¦Ù…Ù‹Ø§</span>
          <span class="badge">Ø§Ù„Ù‡Ø¯Ù: Ø±Ø¬Ø§Ø¡ + Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø£Ù…Ø§Ù…</span>
        </div>
      </div>
      <div class="pill" id="weekPill">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>1) Ù‚ÙŠÙ‘Ù… Ù†ÙØ³Ùƒ Ø¨ØµØ¯Ù‚ (0â€“5)</h3>

        <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="name" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø³ÙŠØ¨Ù‡ ÙØ§Ø¶ÙŠ" />

        <label>Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù‡Ø¹Ù…Ù„Ù‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ø§Ø³Ø¨ÙˆØ¹ Ø¯Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="stepInput" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù‡ØµÙ„ÙŠ 5 Ø¯Ù‚Ø§ÙŠÙ‚ ÙŠÙˆÙ…ÙŠÙ‹Ø§ + Ù‡Ø¨Ø·Ù„ Ù…Ù‚Ø§Ø±Ù†Ø© Ù†ÙØ³ÙŠ" />

        <div id="sections"></div>

        <div class="btns">
          <button class="primary" id="calcBtn">Ø§Ø¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
          <button id="saveBtn">Ø§Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
          <button id="exportBtn">ØªØµØ¯ÙŠØ± CSV</button>
          <button class="danger" id="clearBtn">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <button class="secondary" id="openIntroBtn">Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
        </div>

        <div class="tiny" style="margin-top:10px">
          âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØªØªØ­ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙ‚Ø·. Ø§Ù„Ù‡Ø¯Ù ØªØ´Ø¬ÙŠØ¹ ÙˆØ±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ Ù…Ø´ Ù…Ù‚Ø§Ø±Ù†Ø©.
        </div>
      </div>

      <div class="card">
        <h3>2) Ù†ØªÙŠØ¬ØªÙƒ (Ø±Ø¬Ø§Ø¡ Ù…Ø´ Ù…Ù‚Ø§Ø±Ù†Ø©)</h3>

        <div class="resultBox">
          <div class="row">
            <div class="season">
              <span class="dot" id="seasonDot"></span>
              <span id="seasonText">Ø§Ø¶ØºØ· "Ø§Ø¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©"</span>
            </div>
            <div class="tiny">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¹Ø§Ù…Ø©: <b id="totalText">-</b>/150</div>
          </div>

          <div class="bar" style="margin-top:10px"><i id="totalBar"></i></div>

          <div class="verse" id="verse"></div>
          <div class="verseRef" id="verseRef"></div>
          <div class="step" id="nextStep"></div>
          <div class="btns" style="margin-top:10px">
            <button class="secondary" id="prayBtn">ØµÙ„Ø§Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„Ø±Ø¬Ø§Ø¡</button>
          </div>
          <div class="resultBox" id="prayerBox" style="margin-top:10px;display:none"></div>
          <div class="mini" id="partsBox"></div>
        </div>

        <div style="margin-top:12px" class="tiny">Ø¢Ø®Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª (Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²):</div>
        <div id="historyWrap" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Intro Modal -->
  <div class="modalOverlay" id="introOverlay" style="display:none">
    <div class="modal">
      <h2>ÙƒÙŠÙ ØªÙ†ØªØ¸Ø± Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ Ø³ÙˆÙ ØªØ£ØªÙŠØŸ</h2>
      <p>
        Ø§Ø®ØªØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒØ¨Ø¯Ø§ÙŠØ©â€¦ Ø§Ù„Ù‡Ø¯Ù Ø¥Ù†Ù†Ø§ Ù†ØªÙ…Ø³Ùƒ Ø¨Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆÙ†Ø£Ø®Ø° Ø®Ø·ÙˆØ© Ø¹Ù…Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø©.
      </p>

      <div class="opts">
        <button class="optBtn" data-opt="babil">
          1) Ø£Ù‚Ø¹Ø¯ Ø¹Ù†Ø¯ "Ø£Ù†Ù‡Ø§Ø± Ø¨Ø§Ø¨Ù„" ÙˆØ£ÙØ¶Ù„ Ø£ÙÙƒØ± ÙÙŠ Ø§Ù„Ù„ÙŠ ÙØ§Øª
          <small>Ø­Ø§Ø³Ø³ Ø¥Ù†ÙŠ ÙˆØ§Ù‚Ùâ€¦ ÙˆØ¯Ù‡ Ø¨ÙŠØ£Ø®Ø±Ù†ÙŠ.</small>
        </button>

        <button class="optBtn" data-opt="future">
          2) Ø£Ù‚Ù„Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙˆØ£ÙÙ‚Ø¯ Ø§Ù„Ø±Ø¬Ø§Ø¡
          <small>Ù…Ø­ØªØ§Ø¬ ÙƒÙ„Ù…Ø© Ø±Ø¬Ø§Ø¡ ØªØ«Ø¨ØªÙ†ÙŠ.</small>
        </button>

        <button class="optBtn" data-opt="compare">
          3) Ø£Ø³ØªÙ†Ù‰ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†/Ø£Ù‚Ø§Ø±Ù† Ù†ÙØ³ÙŠ Ø¨Ø§Ù„Ù†Ø§Ø³
          <small>Ø¹Ø§ÙŠØ² Ø£Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ø³ÙŠØ±ØªÙŠ Ø£Ù†Ø§ Ù…Ø¹ Ø§Ù„Ø±Ø¨.</small>
        </button>

        <button class="optBtn" data-opt="move">
          4) Ø£ØªØ­Ø±Ùƒ Ø¨Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø©â€¦ ÙˆØ£Ø«Ù‚ Ø¥Ù† Ø§Ù„Ø±Ø¨ Ø¨ÙŠØ´ØªØºÙ„
          <small>Ù…Ø´ Ù‡Ø£Ø³ØªÙ†Ù‰â€¦ Ù‡Ø§Ø¨Ø¯Ø£.</small>
        </button>
      </div>

      <div class="resultBox" id="introResult" style="margin-top:12px;display:none">
        <div class="verse" id="introText"></div>
        <div class="step" id="introStep"></div>
      </div>

      <div class="modalFooter">
        <div class="tiny">Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±â€¦ Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ®Ø¯ "Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹".</div>
        <div class="btns" style="margin:0">
          <button id="closeIntroBtn">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function isoWeekString(d=new Date()){
    const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dayNum = date.getUTCDay() || 7;
    date.setUTCDate(date.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
    const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1)/7);
    return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,'0')}`;
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }
  function pctFromTotal(total){ return clamp((total/150)*100,0,100); }
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, (m)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  // 5 parts Ã— 6 questions = 30 questions total
  // Each question: 0..5
  // Each part: 0..30
  // Total: 0..150
  const blueprint = [
    {
      key:"spirit",
      title:"1- Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø±ÙˆØ­ÙŠØ©",
      hint:"Ù‡Ù„ ÙÙŠ ÙØªÙˆØ±ØŸ Ù‡Ù„ Ø­Ø§Ø³Ø³ Ø¨Ø­Ø¶ÙˆØ± Ø§Ù„Ù„Ù‡ ÙÙŠ ÙŠÙˆÙ…ÙƒØŸ Ù‡Ù„ ÙÙŠ Ø±Ø¬Ø§Ø¡ Ù„Ù„ØºØ¯ØŸ",
      qs:[
        "Ø­ØªÙ‰ Ù„Ùˆ Ø¨Ù…Ø± Ø¨ÙØªØ±Ø§Øª ÙØªÙˆØ±ØŒ Ø¹Ù†Ø¯ÙŠ Ø±ØºØ¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø£Ø±Ø¬Ø¹ ÙˆØ£Ù†Ù…Ùˆ.",
        "Ø£Ø³ØªØ·ÙŠØ¹ Ø£Ù† Ø£Ø´Ø¹Ø± Ø¨Ø­Ø¶ÙˆØ± Ø§Ù„Ù„Ù‡ ÙÙŠ ÙŠÙˆÙ…ÙŠ.",
        " ÙƒÙ„Ù…Ø© Ø§Ù„Ù„Ù‡ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙŠ Ø­ÙŠØ© ÙˆØ¨ØªØ£Ø«Ø± ÙÙŠ Ù‚Ø±Ø§Ø±Ø§ØªÙŠ Ù…Ø´ Ù…Ø¬Ø±Ø¯ Ø¹Ø§Ø¯Ø©.",
        "Ø¹Ù†Ø¯ÙŠ ÙˆÙ‚Øª Ø«Ø§Ø¨Øª Ù„Ø®Ù„ÙˆØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙƒÙ„ ÙŠÙˆÙ… ÙˆØ¨Ø­Ø¶Ø± Ø§Ù„Ù‚Ø¯Ø§Ø³ Ø¨Ø¥Ù†ØªØ¸Ø§Ù….",
        "Ù„Ù…Ø§ Ø£Ø¶Ø¹Ù Ø£Ùˆ Ø£Ù‚Ø¹â€¦ Ø¨Ø±Ø¬Ø¹ Ø¨Ø³Ø±Ø¹Ø© Ø¨ØªÙˆØ¨Ø© ÙˆØ±ØºØ¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙÙŠ Ø§Ù„ØªØºÙŠÙŠØ±.",
        "Ø¹Ù†Ø¯ÙŠ Ø±Ø¬Ø§Ø¡ Ø¥Ù† Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù„ÙŠ Ø¬Ø§ÙŠØ© Ù…Ù…ÙƒÙ† ØªØ¨Ù‚Ù‰ Ø£ÙØ¶Ù„ ÙˆØ£Ø¹Ù…Ù‚ Ù…Ø¹ Ø§Ù„Ø±Ø¨."
      ]
    },
    {
      key:"work",
      title:"2- Ø§Ù„Ø¹Ù…Ù„",
      hint:"Ù‡Ù„ Ø£Ù†Ø§ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ØŸ Ù‡Ù„ Ø¨ØªÙ‚Ø¯Ù…ØŸ Ù…Ø§Ø°Ø§ Ø£ØªÙˆÙ‚Ø¹ Ù„Ù„ØºØ¯ØŸ",
      qs:[
        "Ø£Ù†Ø§ ÙÙŠ ÙˆØ¸ÙŠÙØ©/Ù…Ø³Ø§Ø± Ù…Ù‡Ù†ÙŠ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¸Ø±ÙˆÙÙŠ Ø­Ø§Ù„ÙŠÙ‹Ø§.",
        "Ø¹Ù„Ø§Ù‚ØªÙŠ Ø¨Ø²Ù…Ù„Ø§Ø¦ÙŠ/ÙØ±ÙŠÙ‚ÙŠ Ù…Ø­ØªØ±Ù…Ø© ÙˆØµØ­ÙŠØ©.",
        "Ø£Ù†Ø§ Ø£Ù…ÙŠÙ† ÙˆÙ…Ù†Ø¶Ø¨Ø· Ø­ØªÙ‰ Ù„Ùˆ Ù…ÙÙŠØ´ Ø­Ø¯ Ø¨ÙŠØ±Ø§Ù‚Ø¨Ù†ÙŠ.",
        "Ø¨Ù„Ø§Ø­Ø¸ ØªØ·ÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ù…Ù‡Ø§Ø±Ø§ØªÙŠ Ø£Ùˆ Ø®Ø¨Ø±ØªÙŠ.",
        "Ù…Ø´ Ø¨Ø³ØªØ³Ù„Ù… Ù„Ù„Ø¶ØºØ·â€¦ Ø¨Ø­Ø§ÙˆÙ„ Ø£Ø±ØªØ¨ ÙŠÙˆÙ…ÙŠ ÙˆØ£ØªØ­Ø±Ùƒ Ø¨Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©.",
        "Ø¹Ù†Ø¯ÙŠ Ø®Ø·Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø±Ø­Ù„Ø© Ø£ÙØ¶Ù„ ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙˆØ«Ù‚Ø© Ø¥Ù† Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ ÙÙŠ Ø¥ÙŠØ¯ Ø±Ø¨Ù†Ø§."
      ]
    },
    {
      key:"study",
      title:"3- Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",
      hint:"Ù…Ø§Ø°Ø§ Ø¹Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠØŸ Ù…Ø§Ø°Ø§ Ø¹Ù† Ø§Ù„Ø¢Ù†ØŸ ÙƒÙŠÙ Ø£Ø±Ù‰ ØºØ¯Ù‹Ø§ØŸ",
      qs:[
        "Ø¹Ù†Ø¯ÙŠ Ø§ØªØ²Ø§Ù† ÙˆØ¥Ù„ØªØ²Ø§Ù… ØªØ¬Ø§Ù‡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©/Ø§Ù„ØªØ¹Ù„Ù….",
        "Ø¨Ø´ØªØºÙ„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± Ù†ÙØ³ÙŠ Ø¨Ø¥Ø³ØªÙ…Ø±Ø§Ø± (Ù…Ù‡Ø§Ø±Ø§Øª/ÙƒÙˆØ±Ø³Ø§Øª/Ù‚Ø±Ø§Ø¡Ø©).",
        "Ø£ØªØ¹Ù„Ù… Ù…Ù† Ø£ÙŠ ØªØ¹Ø«Ø± Ø§Ùˆ ØªØ£Ø®ÙŠØ± ÙÙŠ Ù…Ø³ÙŠØ±ØªÙŠ ÙˆØ£Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ‚Ø¯Ù…."
        "Ø£Ù‚Ø¯Ø± Ø£Ù„ØªØ²Ù… Ø¨Ø®Ø·Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© Ø­ØªÙ‰ Ù„Ùˆ Ø¨Ø³ÙŠØ·Ø©.",
        "Ù…ØµØ¯Ù‚ Ø¥Ù† ØªØ¹Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ Ù„Ù‡ Ø­ØµØ§Ø¯ Ø¨ÙƒØ±Ø©.",
        "Ø¹Ù†Ø¯ÙŠ Ù‡Ø¯Ù ÙˆØ§Ø¶Ø­ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Ø­ØªÙ‰ Ù„Ùˆ ØµØºÙŠØ±)."
      ]
    },
    {
      key:"rel",
      title:"4- Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª / Ø§Ù„ØµØ¯Ø§Ù‚Ø©",
      hint:"Ù‡Ù„ Ø¹Ù†Ø¯ÙŠ Ø´Ø®Øµ Ø¢Ù…Ù†ØŸ Ù‡Ù„ Ø¹Ù„Ø§Ù‚Ø§ØªÙŠ ØµØ­ÙŠØ©ØŸ Ù‡Ù„ ÙÙŠ Ø³Ù„Ø§Ù…ØŸ",
      qs:[
        "Ø¹Ù†Ø¯ÙŠ ØµØ¯ÙŠÙ‚/Ø© Ø£Ù…ÙŠÙ† Ø£Ù‚Ø¯Ø± Ø£ØªÙƒÙ„Ù… Ù…Ø¹Ø§Ù‡/Ù…Ø¹Ø§Ù‡Ø§ Ø¨ØµØ¯Ù‚.",
        "Ø£Ù‚Ø¯Ø± Ø£ÙØªØ­ Ø£Ø¹Ù…Ø§Ù‚ÙŠ Ø¨Ø¯ÙˆÙ† Ø®ÙˆÙ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ù†Ø©.",
        "Ø¹Ù„Ø§Ù‚Ø§ØªÙŠ Ø¨ØªØ¯ÙØ¹Ù†ÙŠ Ù„Ù„Ø®ÙŠØ± ÙˆØ§Ù„Ù†Ù…Ùˆ Ù…Ø´ Ù„Ù„Ø¶ØºØ· Ø£Ùˆ Ø§Ù„Ø®Ø·ÙŠØ©.",
        "Ø¨Ø¹Ø±Ù Ø£Ø­Ø· Ø­Ø¯ÙˆØ¯ ØµØ­ÙŠØ© ÙÙŠ Ø¹Ù„Ø§Ù‚Ø§ØªÙŠ ÙˆØ¨Ø§Ø®ØªØ§Ø± Ø§Ù„Ù„ÙŠ ÙŠØ¨Ù†ÙŠÙ†ÙŠ.",
        "Ø¨Ø¹Ø±Ù Ø£Ø³Ø§Ù…Ø­ ÙˆØ£Ø·Ù„Ø¨ Ù…Ø³Ø§Ù…Ø­Ø© Ø¨Ø¯Ù„ Ø§Ù„ÙƒÙØ¨Ø± Ø£Ùˆ Ø§Ù„Ù‚Ø·ÙŠØ¹Ø©.",
        "Ø£Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…ÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ù…Ù‚Ø§Ø±Ù†Ø§Øª Ù…Ø¤Ø°ÙŠØ©."
      ]
    },
    {
      key:"serv",
      title:"5- Ø§Ù„Ø®Ø¯Ù…Ø©",
      hint:"Ù‡Ù„ ÙÙŠ ÙØªÙˆØ±ØŸ Ù‡Ù„ ÙÙŠ Ù†Ù…Ùˆ Ø¯Ø§Ø®Ù„ÙŠØŸ Ù…Ø§ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©ØŸ",
      qs:[
        "Ø¹Ù†Ø¯ÙŠ Ø±ØºØ¨Ø© ØµØ§Ø¯Ù‚Ø© ÙˆØ£Ø­Ù„Ø§Ù… Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø®Ø¯Ù…Ø©.",
        "Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø¨Ø­Ø³ Ø¨ÙØªÙˆØ±â€¦ Ù„ÙƒÙ† Ø¹Ù†Ø¯ÙŠ Ø¥ØµØ±Ø§Ø± Ø£ÙƒÙ…Ù‘Ù„ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© Ø­ØªÙ‰ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¹Ø¨.",
        "Ø®Ø¯Ù…ØªÙŠ Ù†Ø§Ø¨Ø¹Ø© Ù…Ù† Ø¹Ù„Ø§Ù‚Ø© Ø´Ø®ØµÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Ø§Ù„Ø±Ø¨ Ù…Ø´ Ù…Ø¬Ø±Ø¯ Ù†Ø´Ø§Ø·.",
        "Ø£Ù†Ø§ Ù…Ø³ØªØ¹Ø¯ Ù„Ø±ÙˆØ­ Ø§Ù„Ø§ØªØ¶Ø§Ø¹ (Ø£Ø®Ø¯Ù… Ø¨Ø£Ù…Ø§Ù†Ø© Ø­ØªÙ‰ Ù„Ùˆ Ù…ÙÙŠØ´ Ø¸Ù‡ÙˆØ±).",
        "Ø¨Ø¯ÙˆØ± Ø¹Ù„Ù‰ Ù†Ù…Ùˆ Ø¯Ø§Ø®Ù„ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø´ â€œØ´ÙƒÙ„ Ø®Ø§Ø¯Ù…â€.",
        "Ø¹Ù†Ø¯ÙŠ ØªØµÙˆØ±/Ø®Ø·ÙˆØ© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©."
      ]
    }
  ];

  function renderSections(){
    const root = $("sections");
    root.innerHTML = blueprint.map(sec=>{
      const qsHtml = sec.qs.map((t,idx)=>{
        const id = `${sec.key}_${idx+1}`;
        return `
          <div class="q">
            <div class="qText">${t}</div>
            <div class="qRow">
              <input id="${id}" type="range" min="0" max="5" value="0" />
              <div class="val"><span id="v_${id}">0</span>/5</div>
            </div>
          </div>
        `;
      }).join("");
      return `
        <div class="section">
          <div class="secTitle">
            <b>${sec.title}</b>
            <span class="secHint">${sec.hint}</span>
          </div>
          ${qsHtml}
        </div>
      `;
    }).join("");
  }

  function bindAllSliders(){
    blueprint.forEach(sec=>{
      sec.qs.forEach((_,idx)=>{
        const id = `${sec.key}_${idx+1}`;
        const s = $(id), o = $(`v_${id}`);
        const sync = ()=> o.textContent = s.value;
        s.addEventListener("input", sync);
        sync();
      });
    });
  }

  function getScores(){
    const parts = {};
    blueprint.forEach(sec=>{
      let sum = 0; // 0..30
      sec.qs.forEach((_,idx)=>{
        sum += +$(`${sec.key}_${idx+1}`).value; // 0..5
      });
      parts[sec.key] = sum; // 0..30
    });
    const total = Object.values(parts).reduce((a,b)=>a+b,0); // 0..150
    return {parts, total};
  }

  // Hope-focused "seasons" (not comparing parts)
  function hopeSeason(total, parts){
    // gentle guardrail: very low spiritual score increases "need for restart" message
    const spirit = parts.spirit; // 0..30

    if (spirit <= 6 || total <= 40) return "Ø¨Ø¯Ø§ÙŠØ© Ø±Ø¬Ø§Ø¡";
    if (total <= 85) return "Ø±Ø¬Ø§Ø¡ ÙŠØªØ«Ø¨Øª";
    if (total <= 120) return "Ø±Ø¬Ø§Ø¡ ÙŠØªØ­Ø±Ùƒ";
    return "Ø±Ø¬Ø§Ø¡ ÙŠÙ‚ÙˆØ¯";
  }

  function seasonContent(season){
    switch(season){
      case "Ø¨Ø¯Ø§ÙŠØ© Ø±Ø¬Ø§Ø¡":
        return {
          color: "var(--bad)",
          title: "Ø¨Ø¯Ø§ÙŠØ© Ø±Ø¬Ø§Ø¡ (Ù…ÙÙŠØ´ Ø­ÙƒÙ… Ø¹Ù„ÙŠÙƒ)",
          verse: "Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø£ÙŠØ§Ù… ÙƒØ§Ù†Øª ØµØ¹Ø¨Ø©â€¦ Ø§Ù„Ø±Ø¨ ÙŠÙ‚Ø¯Ø± ÙŠØ¨Ø¯Ø£ Ù…Ø¹Ø§Ùƒ Ù…Ù† Ø¬Ø¯ÙŠØ¯. Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© ØµØ§Ø¯Ù‚Ø© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø·ÙˆÙŠÙ„.",
          ref: "Ù„Ø§ ØªÙ‚Ù Ø¹Ù†Ø¯ Ø§Ù„Ø£Ù„Ù…â€¦ ØªØ­Ø±Ùƒ Ù„Ù„Ø£Ù…Ø§Ù….",
          step: "Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹: 5 Ø¯Ù‚Ø§ÙŠÙ‚ ØµÙ„Ø§Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ + Ù‚Ø±Ø§Ø± Ø¹Ù…Ù„ÙŠ ÙˆØ§Ø­Ø¯ Ø¨Ø³ÙŠØ· (ØªÙ†Ø¸ÙŠÙ…/Ù…ØµØ§Ù„Ø­Ø©/ØªÙˆØ§ØµÙ„/Ù…Ø°Ø§ÙƒØ±Ø©).",
          prayer: "ÙŠØ§ Ø±Ø¨ ÙŠØ³ÙˆØ¹ØŒ Ø£Ù†Ø§ Ø¬Ø§ÙŠ Ù„Ùƒ Ø²ÙŠ Ù…Ø§ Ø£Ù†Ø§ØŒ Ø¨ÙØªÙˆØ±ÙŠ ÙˆØ¶Ø¹ÙÙŠ ÙˆØ¹Ø¯Ù… Ø«Ø¨Ø§ØªÙŠ.\nØ­Ø· ÙÙŠ Ù‚Ù„Ø¨ÙŠ Ø±Ø¬Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ØŒ ÙˆØ§Ø¯Ù‘ÙŠÙ†ÙŠ Ù†Ø¹Ù…Ø© Ø£Ø¨Ø¯Ø£ Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ù…Ø¹Ø§Ùƒ Ù…Ù† Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡."
        };
      case "Ø±Ø¬Ø§Ø¡ ÙŠØªØ«Ø¨Øª":
        return {
          color: "var(--warn)",
          title: "Ø±Ø¬Ø§Ø¡ ÙŠØªØ«Ø¨Øª",
          verse: "ÙÙŠÙ‡ Ø±Ø¬Ø§Ø¡â€¦ ÙˆØ¯Ù‡ Ù…Ø­ØªØ§Ø¬ ØªØ«Ø¨ÙŠØª Ø¹Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø¯Ù„ Ø§Ù„ØªØ´ØªØª. Ù…Ø´ Ù„Ø§Ø²Ù… ÙƒÙ„ Ø­Ø§Ø¬Ø© ØªØªØºÙŠØ± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.",
          ref: "Ù„Ø§ ØªÙŠØ£Ø³ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ â€” Ø§Ù„Ø±Ø¨ Ù…Ø§Ø²Ø§Ù„ ÙŠØ¹Ù…Ù„.",
          step: "Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹: Ø¹Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ø§Ø¨ØªØ© 7 Ø£ÙŠØ§Ù… (ØµÙ„Ø§Ø©/ÙƒÙ„Ù…Ø©/Ù†Ø¸Ø§Ù… Ù†ÙˆÙ…/Ù…Ø°Ø§ÙƒØ±Ø©) + Ø´Ø®Øµ ØªØªØ§Ø¨Ø¹ Ù…Ø¹Ø§Ù‡.",
          prayer: "ÙŠØ§ Ø±Ø¨ØŒ Ø´ÙƒØ±Ø§Ù‹ Ø¥Ù† ÙÙŠ Ù†ÙˆØ± ÙˆÙ„Ùˆ ØµØºÙŠØ± ÙÙŠ Ø­ÙŠØ§ØªÙŠ.\nØ«Ø¨Ù‘ØªÙ†ÙŠ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„ØµØ­ØŒ ÙˆØ®Ù„ÙŠÙ†ÙŠ Ù…Ø§ Ø£Ø±Ø¬Ø¹Ø´ ØªØ§Ù†ÙŠ Ù„Ù„ÙƒØ³Ù„ Ø£Ùˆ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©."
        };
      case "Ø±Ø¬Ø§Ø¡ ÙŠØªØ­Ø±Ùƒ":
        return {
          color: "var(--good)",
          title: "Ø±Ø¬Ø§Ø¡ ÙŠØªØ­Ø±Ùƒ",
          verse: "Ø£Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚â€¦ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø«Ø¨Ø§Øª. Ù…Ø§ ØªØ¨ØµÙ‘Ø´ Ø¹Ù„Ù‰ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯â€¦ Ø¨ØµÙ‘ Ù„Ù„Ù…Ø³ÙŠØ±Ø© ÙƒÙ„Ù‡Ø§.",
          ref: "Ø§Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ù…Ø³ÙŠØ±ØªÙƒâ€¦ ÙˆÙ„ÙŠØ³ Ù„Ù…ÙˆØ§Ù‚Ù Ù…ØªÙ‚Ø·Ø¹Ø©.",
          step: "Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹: Ù‡Ø¯Ù Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙˆØ§Ø­Ø¯ + 3 Ø®Ø·ÙˆØ§Øª ØµØºÙŠØ±Ø© + Ø±Ø§Ø­Ø© ØµØ­ÙŠØ©.",
          prayer: "ÙŠØ§ Ø±Ø¨ØŒ Ø¥Ù†Øª Ø§Ù„Ù„ÙŠ Ø¨Ø¯Ø£Øª ÙÙŠÙ‘ Ø´ØºÙ„ Ø­Ù„ÙˆØŒ ÙƒÙ…Ù‘Ù„ Ø¥Ù†Øª Ø§Ù„Ù„ÙŠ Ø§Ø¨ØªØ¯ÙŠØªÙ‡.\nØ¹Ù„Ù‘Ù…Ù†ÙŠ Ø£Ø¨Øµ Ù„Ù…Ø³ÙŠØ±ØªÙŠ ÙƒÙ„Ù‡Ø§ØŒ ÙˆØ£Ù…Ø´ÙŠ Ø¨Ø«Ù‚Ø© Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø·ÙˆÙŠÙ„."
        };
      default:
        return {
          color: "var(--blue)",
          title: "Ø±Ø¬Ø§Ø¡ ÙŠÙ‚ÙˆØ¯",
          verse: "Ø¬Ù…ÙŠÙ„â€¦ Ø®Ù„ÙŠÙƒ Ø³Ø¨Ø¨ Ø±Ø¬Ø§Ø¡ Ù„ØºÙŠØ±Ùƒ. Ø§Ù„Ø£ÙŠØ§Ù… Ù…Ø´ Ù„Ø§Ø²Ù… ØªØ¨Ù‚Ù‰ ÙƒÙ„Ù‡Ø§ Ø³Ù‡Ù„Ø©â€¦ Ù„ÙƒÙ† ØªÙ‚Ø¯Ø± ØªØ¨Ù‚Ù‰ ÙƒÙ„Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø±Ø¨.",
          ref: "ÙŠÙƒÙÙŠ Ø£Ù† ØªÙƒÙˆÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù… Ù…Ø¹ Ø§Ù„Ø±Ø¨.",
          step: "Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹: ØªØ§Ø¨Ø¹ Ø´Ø®Øµ ÙˆØ§Ø­Ø¯/Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø®Ø¯Ù…Ø© Ù…Ø­Ø¯Ø¯Ø© + Ø§Ø³ØªÙ…Ø± ÙÙŠ ÙˆÙ‚ØªÙƒ Ù…Ø¹ Ø§Ù„Ø±Ø¨.",
          prayer: "ÙŠØ§ Ø±Ø¨ØŒ Ø®Ù„Ù‘ÙŠ Ø­Ø¶ÙˆØ±ÙŠ Ù…Ø¹Ø§Ùƒ Ù‡Ùˆ Ù…ØµØ¯Ø± Ù‚ÙˆØªÙŠ ÙˆÙØ±Ø­ÙŠ.\nØ§Ø³ØªØ®Ø¯Ù…Ù†ÙŠ Ø£ÙƒÙˆÙ† Ø³Ø¨Ø¨ Ø±Ø¬Ø§Ø¡ ÙˆÙ†ÙˆØ± Ù„ÙƒÙ„ Ø­Ø¯ Ø­ÙˆØ§Ù„ÙŠØ§."
        };
    }
  }

  function partLabel(key){
    return ({
      spirit:"Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø±ÙˆØ­ÙŠØ©",
      work:"Ø§Ù„Ø¹Ù…Ù„",
      study:"Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",
      rel:"Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª/Ø§Ù„ØµØ¯Ø§Ù‚Ø©",
      serv:"Ø§Ù„Ø®Ø¯Ù…Ø©"
    })[key] || key;
  }

  // Gentle, non-comparative encouragement per part
  function partEncourage(key, score){
    // score 0..30
    if (score <= 10){
      switch(key){
        case "spirit": return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ: Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¨Ø¯ÙˆÙ† Ø¶ØºØ·â€¦ 5 Ø¯Ù‚Ø§ÙŠÙ‚ ÙŠÙˆÙ…ÙŠÙ‹Ø§ ØªÙƒÙÙŠ ÙƒØ¨Ø¯Ø§ÙŠØ©.";
        case "work": return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ: Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù…Ù„ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø£ÙØ¶Ù„ Ù…Ù† Ù„ÙˆÙ… Ø§Ù„Ø¸Ø±ÙˆÙ.";
        case "study": return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ: Ù…ÙÙŠØ´ ÙØ´Ù„ Ù†Ù‡Ø§Ø¦ÙŠâ€¦ ÙÙŠÙ‡ ØªØ¹Ù„Ù… ÙˆÙ‚ÙŠØ§Ù…. Ø§Ø¨Ø¯Ø£ Ø¨Ø®Ø·Ø© ØµØºÙŠØ±Ø©.";
        case "rel": return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ: Ø§Ø®ØªØ§Ø± Ø´Ø®Øµ Ø£Ù…ÙŠÙ†/Ø© ÙˆØ§Ø¨Ø¯Ø£ Ø¨ØµØ±Ø§Ø­Ø© ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ØŒ ÙˆØ­Ø¯ÙˆØ¯ ØµØ­ÙŠØ©.";
        case "serv": return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡ Ù„ÙŠÙƒ: Ù…Ø´ Ù…Ù‡Ù… Ø§Ù„Ø´ÙƒÙ„â€¦ Ø§Ù„Ù…Ù‡Ù… Ø§Ù„Ù‚Ù„Ø¨. Ø®Ù„ÙŠÙƒ Ø«Ø§Ø¨Øª ÙÙŠ Ø®Ø¯Ù…Ø© Ø¨Ø³ÙŠØ·Ø©.";
      }
    }
    if (score <= 20){
      return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡: Ø£Ù†Øª Ù…Ø§Ø´ÙŠ ÙƒÙˆÙŠØ³ Ø¬Ø¯Ø§Ù‹â€¦ Ø«Ø¨Ù‘Øª Ø¹Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ§Ø·Ù„Ø¨ Ù…Ø³Ø§Ù†Ø¯Ø©/Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Ø­Ø¯ ØªØ§Ù†ÙŠ.";
    }
    return "Ø±Ø³Ø§Ù„Ø© Ø±Ø¬Ø§Ø¡: Ù…Ù…ØªØ§Ø²â€¦ Ø®Ù„ÙŠÙƒ Ø³Ø¨Ø¨ Ø±Ø¬Ø§Ø¡ Ù„ØºÙŠØ±Ùƒ Ø¨Ø®Ø·ÙˆØ© Ø®Ø¯Ù…Ø© Ø£Ùˆ Ù…ØªØ§Ø¨Ø¹Ø© Ø´Ø®Øµ.";
  }

  function renderResult(){
    const {parts, total} = getScores();
    const season = hopeSeason(total, parts);
    const c = seasonContent(season);
    window.__currentPrayer = c.prayer || "";
    $("seasonText").textContent = `${c.title}`;
    $("seasonDot").style.background = c.color;

    $("totalText").textContent = total;
    $("totalBar").style.width = `${pctFromTotal(total)}%`;

    $("verse").innerHTML = `<b>${escapeHtml(c.verse)}</b>`;
    $("verseRef").textContent = c.ref;

    const customStep = $("stepInput").value.trim();
    $("nextStep").innerHTML = customStep
      ? `<b>Ø®Ø·ÙˆØªÙŠ Ø§Ù„Ù…ÙƒØªÙˆØ¨Ø©:</b> ${escapeHtml(customStep)}`
      : `<b>Ø§Ù‚ØªØ±Ø§Ø­ Ø¹Ù…Ù„ÙŠ:</b> ${escapeHtml(c.step)}`;

    // show parts as supportive indicators (no ranking)
    const partsHtml = Object.entries(parts).map(([k,v])=>{
      const pct = clamp((v/30)*100,0,100);
      return `
        <div class="kpi">
          <b>${partLabel(k)}</b>
          <span class="tiny"><b>${v}</b>/30</span>
        </div>
        <div class="bar"><i style="width:${pct}%"></i></div>
        <div class="tiny" style="margin-top:6px">${escapeHtml(partEncourage(k,v))}</div>
        <div style="height:10px"></div>
      `;
    }).join("");

    $("partsBox").innerHTML = `<b style="font-size:13px">Ù…Ø¤Ø´Ø±Ø§Øª ØªØ´Ø¬ÙŠØ¹ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ù…Ù‚Ø§Ø±Ù†Ø©):</b><div style="margin-top:8px">${partsHtml}</div>`;

    return {parts, total, season, step: customStep || c.step};
  }

  // Intro modal logic
  function showIntro(choiceText, stepText){
    $("introResult").style.display = "block";
    $("introText").innerHTML = `<b>Ø¥Ø¬Ø§Ø¨ØªÙƒ:</b> ${escapeHtml(choiceText)}`;
    $("introStep").innerHTML = `<b>Ø§Ù‚ØªØ±Ø§Ø­ Ø¹Ù…Ù„ÙŠ:</b> ${escapeHtml(stepText)}`;
  }

  function introChoice(opt){
    if (opt === "babil"){
      showIntro(
        "Ø£Ù‚Ø¹Ø¯ Ø¹Ù†Ø¯ Ø£Ù†Ù‡Ø§Ø± Ø¨Ø§Ø¨Ù„ ÙˆØ£ÙØ¶Ù„ Ø£ÙÙƒØ± ÙÙŠ Ø§Ù„Ù„ÙŠ ÙØ§Øª",
        "Ù‚Ø±Ø§Ø± ØµØºÙŠØ±: Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ Ù‡ØªØ­Ø±Ùƒ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© (ØµÙ„Ø§Ø© 5 Ø¯Ù‚Ø§ÙŠÙ‚ + ØªØ±ØªÙŠØ¨ Ø­Ø§Ø¬Ø© ÙˆØ§Ø­Ø¯Ø©)."
      );
    } else if (opt === "future"){
      showIntro(
        "Ø£Ù‚Ù„Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙˆØ£ÙÙ‚Ø¯ Ø§Ù„Ø±Ø¬Ø§Ø¡",
        "Ù‚Ø±Ø§Ø± ØµØºÙŠØ±: Ù‡ØªÙ…Ø³Ùƒ Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¨â€¦ Ù‡ÙƒØªØ¨ Ù‡Ø¯Ù Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙˆØ§Ø­Ø¯ ÙˆØ£Ø¨Ø¯Ø£ ÙÙŠÙ‡ ÙÙˆØ±Ù‹Ø§."
      );
    } else if (opt === "compare"){
      showIntro(
        "Ø£Ø³ØªÙ†Ù‰ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†/Ø£Ù‚Ø§Ø±Ù† Ù†ÙØ³ÙŠ Ø¨Ø§Ù„Ù†Ø§Ø³",
        "Ù‚Ø±Ø§Ø± ØµØºÙŠØ±: Ù‡Ø¨Ø·Ù„ Ù…Ù‚Ø§Ø±Ù†Ø©â€¦ Ù‡Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ø³ÙŠØ±ÙŠ Ø£Ù†Ø§ ÙˆØ®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø·Ø±ÙŠÙ‚ÙŠ."
      );
    } else {
      showIntro(
        "Ø£ØªØ­Ø±Ùƒ Ø¨Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø©â€¦ ÙˆØ£Ø«Ù‚ Ø¥Ù† Ø§Ù„Ø±Ø¨ Ø¨ÙŠØ´ØªØºÙ„",
        "Ù‚Ø±Ø§Ø± ØµØºÙŠØ±: Ù‡Ø«Ø¨Øª Ø¹Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¯Ù‡ ÙˆØ£ØªØ§Ø¨Ø¹Ù‡Ø§ 7 Ø£ÙŠØ§Ù…."
      );
    }
  }

  // Weekly history
  const KEY = "ayyam_weekly_history_v2";
  function loadHistory(){ try{ return JSON.parse(localStorage.getItem(KEY) || "[]"); }catch{ return []; } }
  function saveHistory(items){ localStorage.setItem(KEY, JSON.stringify(items)); }
  function addEntry(entry){
    const h = loadHistory(); h.unshift(entry);
    saveHistory(h.slice(0,26));
  }

  function renderHistory(){
    const h = loadHistory();
    if(!h.length){
      $("historyWrap").innerHTML = `<div class="tiny">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.</div>`;
      return;
    }
    const rows = h.slice(0,8).map(e=>{
      const pct = clamp((e.total/150)*100,0,100);
      return `
        <div class="resultBox" style="margin-bottom:10px">
          <div class="row">
            <div class="tiny"><b>${escapeHtml(e.week)}</b></div>
            <div class="tiny">${escapeHtml(e.season)}</div>
            <div class="tiny"><b>${e.total}</b>/150</div>
          </div>
          <div class="bar" style="margin-top:10px"><i style="width:${pct}%"></i></div>
          ${e.step ? `<div class="tiny" style="margin-top:10px"><b>Ø®Ø·ÙˆØªÙŠ:</b> ${escapeHtml(e.step)}</div>` : ``}
        </div>
      `;
    }).join("");
    $("historyWrap").innerHTML = rows;
  }

  function exportCSV(){
    const h = loadHistory();
    if(!h.length){ alert("Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±."); return; }
    const header = ["week","name","total","season","spirit","work","study","rel","serv","step","createdAt"];
    const lines = [header.join(",")].concat(
      h.map(e => header.map(k => `"${String(e[k] ?? "").replace(/"/g,'""')}"`).join(","))
    );
    const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "ayyam_wa_ayyam_weekly_review.csv";
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  function clearAll(){
    if(!confirm("Ù…ØªØ£ÙƒØ¯ Ø§Ù†Ùƒ Ø¹Ø§ÙˆØ² ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ")) return;
    localStorage.removeItem(KEY);
    renderHistory();
    alert("ØªÙ… Ø§Ù„Ù…Ø³Ø­.");
  }

  // init
  $("weekPill").textContent = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: ${isoWeekString()}`;
  renderSections();
  bindAllSliders();
  renderHistory();

  $("calcBtn").addEventListener("click", renderResult);
  $("prayBtn").addEventListener("click", ()=>{
  const text = (window.__currentPrayer || "").trim();
  if(!text){
    alert("Ø§Ø¹Ù…Ù„ 'Ø§Ø¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø©' Ø§Ù„Ø£ÙˆÙ„ ğŸ™");
    return;
  }
  const box = $("prayerBox");
  box.style.display = "block";
  box.innerHTML = `<div class="verse"><b>ØµÙ„Ø§Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„Ø±Ø¬Ø§Ø¡:</b><br>${escapeHtml(text).replace(/\n/g,"<br>")}</div>`;
  });
  $("saveBtn").addEventListener("click", ()=>{
    const r = renderResult();
    const entry = {
      week: isoWeekString(),
      name: ($("name").value || "").trim(),
      total: r.total,
      season: r.season,
      ...r.parts,
      step: r.step,
      createdAt: new Date().toISOString()
    };
    addEntry(entry);
    renderHistory();
    alert("Ø§ØªØ­ÙØ¸Øª âœ…");
  });

  $("exportBtn").addEventListener("click", exportCSV);
  $("clearBtn").addEventListener("click", clearAll);

  // intro handlers
  $("openIntroBtn").addEventListener("click", ()=>{
    $("introOverlay").style.display = "flex";
    $("introResult").style.display = "none";
  });
  $("closeIntroBtn").addEventListener("click", ()=>{
    $("introOverlay").style.display = "none";
  });
  document.querySelectorAll(".optBtn").forEach(btn=>{
    btn.addEventListener("click", ()=> introChoice(btn.dataset.opt));
  });

  // open intro on first visit
  /*const seen = localStorage.getItem("ayyam_seen_intro_v2");
  if(!seen){
    $("introOverlay").style.display = "flex";
    localStorage.setItem("ayyam_seen_intro_v2","1");
  }*/
  $("introOverlay").style.display = "flex";
</script>
</body>
</html>






